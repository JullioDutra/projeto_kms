{% extends 'core/base.html' %}

{% block title %}Duelo 1x1 KM - Arena KMS{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary-blue: #00d2ff;
        --deep-blue: #3a7bd5;
        --primary-red: #ff416c;
        --deep-red: #ff4b2b;
        --gold: #ffd700;
    }

    /* --- ARENA CARDS --- */
    .arena-card { 
        background: linear-gradient(145deg, #1a1a1c 0%, #0a0a0b 100%); 
        border-radius: 30px; 
        padding: 30px 20px; 
        margin-bottom: 35px; 
        border: 1px solid rgba(255, 255, 255, 0.08); 
        box-shadow: 0 20px 50px rgba(0,0,0,0.6); 
        position: relative; 
        overflow: hidden;
    }

    /* Brilho no contorno do vencedor ou do card ativo */
    .arena-card::before {
        content: ""; position: absolute; top: 0; left: 0; right: 0; height: 4px;
        background: linear-gradient(90deg, var(--primary-blue), var(--primary-red));
    }

    /* --- AVATARES COM FOTO --- */
    .athlete-photo-container {
        width: 90px; height: 90px; margin: 0 auto 15px; position: relative;
    }
    
    .athlete-photo {
        width: 100%; height: 100%; border-radius: 50%; object-fit: cover;
        border: 3px solid; padding: 3px; background: #000;
        box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }

    .photo-blue { border-color: var(--primary-blue); box-shadow: 0 0 15px rgba(0, 210, 255, 0.4); }
    .photo-red { border-color: var(--primary-red); box-shadow: 0 0 15px rgba(255, 65, 108, 0.4); }

    .vs-text-vibrant {
        font-size: 2.8rem; font-weight: 900; font-style: italic;
        background: linear-gradient(180deg, #fff 30%, var(--gold) 100%);
        -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        opacity: 0.9; margin-bottom: 50px;
    }

    /* --- TANQUES INTEGRADOS --- */
    .tank-slim-v2 {
        width: 65px; height: 180px; background: rgba(255,255,255,0.03);
        border: 2px solid #333; border-radius: 10px 10px 20px 20px;
        margin: 0 auto; position: relative; overflow: hidden;
    }
    
    .fill-blue { background: linear-gradient(180deg, var(--primary-blue), var(--deep-blue)); }
    .fill-red { background: linear-gradient(180deg, var(--primary-red), var(--deep-red)); }
    
    .perc-tag {
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        font-weight: 900; font-size: 1.1rem; color: #fff; text-shadow: 0 2px 4px #000; z-index: 5;
    }

    .duel-meta-badge {
        background: rgba(255, 215, 0, 0.1); color: var(--gold);
        border: 1px solid var(--gold); padding: 5px 15px;
        border-radius: 50px; font-weight: 800; font-size: 0.8rem;
        text-transform: uppercase; letter-spacing: 1px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-2" style="max-width: 550px;">
    
    <div class="d-flex justify-content-between align-items-center mb-4 px-2">
        <h3 class="fw-900 mb-0 text-white">ARENA <span class="text-danger">DE DUELOS</span></h3>
        <button class="btn btn-sm fw-900 px-3 py-2" style="background: var(--primary-red); color: white; border-radius: 12px;" data-bs-toggle="modal" data-bs-target="#novoDesafioModal">
            NOVO X1
        </button>
    </div>

    {% for d in desafios %}
        {% if d.status == 'ativo' %}
        <div class="arena-card" id="cartaoDesafio_{{ d.id }}">
            <div class="text-center mb-4">
                <span class="duel-meta-badge">Objetivo: {{ d.alvo_km|floatformat:0 }}KM</span>
                <p class="text-muted small fw-bold mt-2 mb-0">PRAZO: {{ d.prazo_dias }} DIAS RESTANTES</p>
            </div>

            <div class="d-flex justify-content-around align-items-end mb-4">
                <div class="text-center" style="width: 120px;">
                    <div class="athlete-photo-container">
                        {% if d.avatar_desafiante %}
                            <img src="{{ d.avatar_desafiante }}" class="athlete-photo photo-blue">
                        {% else %}
                            <div class="athlete-photo photo-blue d-flex align-items-center justify-content-center text-white fw-bold fs-2">{{ d.desafiante|first|upper }}</div>
                        {% endif %}
                    </div>
                    <h6 class="fw-900 text-white mb-3">{{ d.desafiante|upper }}</h6>
                    <div class="tank-slim-v2">
                        <div class="perc-tag">{{ d.porc_desafiante|floatformat:0 }}%</div>
                        <div class="fill-blue" style="width: 100%; height: {{ d.porc_desafiante }}%; position: absolute; bottom: 0;"></div>
                    </div>
                    <h5 class="fw-900 mt-3 text-info">{{ d.km_desafiante|floatformat:1 }} <small style="font-size: 0.7rem;">KM</small></h5>
                </div>

                <div class="vs-text-vibrant">VS</div>

                <div class="text-center" style="width: 120px;">
                    <div class="athlete-photo-container">
                        {% if d.avatar_desafiado %}
                            <img src="{{ d.avatar_desafiado }}" class="athlete-photo photo-red">
                        {% else %}
                            <div class="athlete-photo photo-red d-flex align-items-center justify-content-center text-white fw-bold fs-2">{{ d.desafiado|first|upper }}</div>
                        {% endif %}
                    </div>
                    <h6 class="fw-900 text-white mb-3">{{ d.desafiado|upper }}</h6>
                    <div class="tank-slim-v2">
                        <div class="perc-tag">{{ d.porc_desafiado|floatformat:0 }}%</div>
                        <div class="fill-red" style="width: 100%; height: {{ d.porc_desafiado }}%; position: absolute; bottom: 0;"></div>
                    </div>
                    <h5 class="fw-900 mt-3 text-danger">{{ d.km_desafiado|floatformat:1 }} <small style="font-size: 0.7rem;">KM</small></h5>
                </div>
            </div>

            <button onclick="partilharDesafio({{ d.id }})" class="btn w-100 fw-900 py-3 rounded-pill" style="background: #25D366; color: white; border: none; box-shadow: 0 10px 20px rgba(37, 211, 102, 0.2);">
                <i class="bi bi-whatsapp me-2"></i> CONVOCAR A TORCIDA
            </button>
        </div>
        {% endif %}
    {% endfor %}
</div>
{% endblock %}
